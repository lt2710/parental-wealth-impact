read.dta13("CHARLS2015/Housing_Characteristics.dta")
hh_house_2015 <- hh_house_raw_2015 %>% select(
hhid = householdID,
buildyear = i005,
buildyear_range = i005_1,
bedrooms = i012_1
)
house_2015 <- full_join(hh_income_2015,
hh_house_2015,
by = "hhid")
for (i in 1:nrow(house_2015)) {
if (is.na(house_2015$samehouse[i]) == FALSE &
house_2015$samehouse[i] == "2 No") {
house_2015$buildarea[i] <- NA
house_2015$obtainway[i] <- NA
house_2015$obtainyear[i] <- NA
house_2015$obtaincost[i] <- NA
}
if (is.na(house_2015$homevalue[i]) == FALSE &
house_2015$homevalue[i] >= 1000) {
house_2015$homevalue[i] <- house_2015$homevalue[i] / 10000
}
if (is.na(house_2015$homevalue2[i]) == FALSE &
house_2015$homevalue2[i] > 1000) {
house_2015$homevalue[i] <- house_2015$homevalue[i] / 1000
}
if (is.na(house_2015$homevalue[i]) == TRUE &
house_2015$homevalueunit[i] == "2 Unit Price (1000 Yuan/M2)" &
is.na(house_2015$buildarea[i]) == FALSE &
is.na(house_2015$homevalue2[i]) == FALSE) {
if (house_2015$homevalue2[i] >= 500) {
house_2015$homevalue2[i] <- house_2015$homevalue2[i] / 1000
}
house_2015$homevalue[i] <-
house_2015$buildarea[i] * house_2015$homevalue2[i] / 10
}
if (is.na(house_2015$homevalue[i]) == TRUE &
is.na(house_2015$bracketlow[i]) == FALSE &
is.na(house_2015$brackethigh[i]) == FALSE) {
house_2015$homevalue[i] <-
(house_2015$bracketlow[i] + house_2015$brackethigh[i]) / (2 * 10000)
} else if (is.na(house_2015$homevalue[i]) == TRUE &
is.na(house_2015$bracketlow[i]) == FALSE) {
house_2015$homevalue[i] <- house_2015$bracketlow[i] / 10000
} else if (is.na(house_2015$homevalue[i]) == TRUE &
is.na(house_2015$brackethigh[i]) == FALSE) {
house_2015$homevalue[i] <- house_2015$brackethigh[i] / 10000
}
}
house_2015 <- house_2015 %>% select(hhid,
homeownership,
homevalue,
obtainway,
obtainyear,
obtaincost)
for (i in 1:nrow(house_2015)) {
if (is.na(house_2015$obtaincost[i]) == FALSE &
house_2015$obtaincost[i] >= 500) {
house_2015$obtaincost[i] <- house_2015$obtaincost[i] / 10000
}
}
house_2015$obtainway <- house_2015$obtainway %>% as.character()
house_2015$obtainway[house_2015$obtainway == "1 Market"] <- "Market"
house_2015$obtainway[house_2015$obtainway == "2 Working Unit of Household Member"] <-
"Working unit"
house_2015$obtainway[house_2015$obtainway == "6 Self-built"] <-
"Self-built"
house_2015$obtainway[house_2015$obtainway == "8 Compensation for Old Home"] <-
"Compensation for Old Home"
house_2015$obtainway[house_2015$obtainway %in% c(
"3 Child Non-household Member",
"4 Parents Non-household Member",
"5 Other Relatives",
"7 Inherited or Given",
"9 Other"
)] <- "Other"
house_2015$homevalue[house_2015$homeownership == "3 None of Household Member"] <-
0
house_2015 <- house_2015 %>% mutate(hhid = hhid %>% as.character()
)
ind_2014 <- full_join(hukou_2014, party_2014, by = "id")
ind_2014 <- full_join(ind_2014, education_2014, by = "id")
ind_2014 <- full_join(ind_2014, work_2014, by = "id")
ind_2015 <- demographic_2015 %>% select(-address0,-otheraddress,-address1,-birthyear,)
dta_ind <- full_join(ind_2014, ind_2015, by = "id")
dta_hh <- full_join(dta_ind, house_2015, by = "hhid")
dta_hh <- full_join(dta_hh, networth_2015, by = "hhid")
dta_hh <-
dta_hh %>% mutate(net_worth_real = (net_worth + homevalue * 10000) / 10000)
psu_raw <- read.dta13("CHARLS2013/PSU.dta",
fromEncoding = "GB2312",
convert.factors = FALSE)
psu_raw$tier <- NA
psu_raw$tier[psu_raw$city %in% c(
"上海市",
"北京",
"深圳市",
"广州市",
"重庆市",
"天津",
"苏州市",
"成都市",
"武汉市",
"杭州市",
"南京市",
"西安市",
"长沙市",
"沈阳市",
"青岛市",
"郑州市",
"大连市",
"东莞市",
"宁波市"
)] <- "tier1"
psu_raw$tier[psu_raw$city %in% c(
"厦门市",
"福州市",
"无锡市",
"合肥市",
"昆明市",
"哈尔滨市",
"哈尔滨",
"济南市",
"佛山市",
"长春市",
"温州市",
"石家庄市",
"南宁市",
"常州市",
"泉州市",
"南昌市",
"贵阳市",
"太原市",
"烟台市",
"嘉兴市",
"南通市",
"金华市",
"珠海市",
"惠州市",
"徐州市",
"海口市",
"乌鲁木齐市",
"绍兴市",
"中山市",
"台州市",
"兰州市"
)] <- "tier2"
psu_raw$tier[psu_raw$city %in% c(
"潍坊市",
"保定市",
"镇江市",
"扬州市",
"桂林市",
"唐山市",
"三亚市",
"湖州市",
"呼和浩特市",
"廊坊市",
"洛阳市",
"威海市",
"盐城市",
"临沂市",
"江门市",
"汕头市",
"泰州市",
"漳州市",
"邯郸市",
"济宁市",
"芜湖市",
"淄博市",
"银川市",
"柳州市",
"绵阳市",
"湛江市",
"鞍山市",
"赣州市",
"大庆市",
"宜昌市",
"包头市",
"咸阳市",
"秦皇岛市",
"株洲市",
"莆田市",
"吉林市",
"淮安市",
"肇庆市",
"宁德市",
"衡阳市",
"南平市",
"连云港市",
"丹东市",
"丽江市",
"揭阳市",
"延边朝鲜族自治州",
"舟山市",
"九江市",
"龙岩市",
"沧州市",
"抚顺市",
"襄阳市",
"上饶市",
"营口市",
"三明市",
"蚌埠市",
"丽水市",
"岳阳市",
"清远市",
"荆州市",
"泰安市",
"衢州市",
"盘锦市",
"东营市",
"南阳市",
"马鞍山市",
"南充市",
"西宁市",
"孝感市",
"齐齐哈尔市"
)] <- "tier3"
psu_raw$tier[is.na(psu_raw$tier) == TRUE] <- "tier4"
psu <- psu_raw %>% select(cid = communityID,
tier)
child_raw_2015 <- read.dta13("CHARLS2015/Child.dta")
#Child data
child_2015 <- child_raw_2015 %>% select(
id = ID,
hhid = householdID,
cid = communityID,
childid = childID,
gender = gender,
age = age,
independence = cb053,
distance = cb053_2,
education = cb052_w3,
hukou = cb055,
marriage = cb063,
party = cb063_w3_2,
income = cb069,
home = cb071_w3,
homevalue = cb072_w3,
urban = cb054
) %>% left_join(psu, by = "cid")
child_2015$gender <-
child_2015$gender %>% as.numeric() %>% factor(levels = c(2, 1),
labels = c("Female",
"Male"))
child_2015$marriage <- child_2015$marriage %>% as.character()
child_2015$marriage[child_2015$marriage == "1 Married With Spouse At Present" |
child_2015$marriage == "2 Married But Not Living With Spouse Temporarily" |
child_2015$marriage == "3 Separated" |
child_2015$marriage == "4 Divorced" |
child_2015$marriage == "5 Widowed"] <- 2
child_2015$marriage[child_2015$marriage == "6 Never Married" |
child_2015$marriage == "7 Cohabitated"] <- 1
child_2015$marriage <- child_2015$marriage %>% factor(levels = c(1, 2),
labels = c("Not married",
"Married"))
child_2015$party <-
child_2015$party %>% as.numeric %>% factor(levels = c(2, 1),
labels = c("Not Party member",
"Party member"))
child_2015$hukou <- child_2015$hukou %>% as.character()
child_2015$hukou[child_2015$hukou == "3 Unified Residency Hukou"] <-
"2 Non-Agricultural Hukou"
child_2015$hukou[child_2015$hukou == "4 Does Not Have Hukou"] <- NA
address <- demographic_2015 %>% select(hhid,
role,
address)
child_2015$address_parent <- NA
for (i in 1:nrow(child_2015)) {
hhidi <- child_2015$hhid[i]
addresses <- address %>% filter(hhid == hhidi)
if (addresses$address[addresses$role == "1 male"] %>% length > 0) {
child_2015$address_parent[i] <-
addresses$address[addresses$role == "1 male"][1]
} else{
if (addresses$address[addresses$role == "2 female"] %>% length > 0)
child_2015$address_parent[i] <-
addresses$address[addresses$role == "2 female"][1]
}
}
child_2015$urban <- child_2015$urban %>% as.character()
for (i in 1:nrow(child_2015)) {
if (child_2015$independence[i] %in% c(
"1 This Household, And Economicly Dependent",
"2 This Household, But Economicly Independent",
"3 The Same Or Adjacent Dwelling/Courtyard With You"
)) {
child_2015$urban[i] <- child_2015$address_parent[i]
}
if (child_2015$independence[i] %in% c(
"4 Another Household In Your Permanent Address's Village/Neighorhood",
"5 Another Village/Neighborhood In Your Permanent Address's County/City/District"
) &
is.na(child_2015$urban[i]) == TRUE) {
child_2015$urban[i] <- child_2015$address_parent[i]
}
}
child_2015$urban[child_2015$urban %in% c("1 Main City Zone")] <- 3
child_2015$urban[child_2015$urban %in% c(
"2 Combination Zone Between Urban and Rural Areas",
"2 Combination Zone Between Urban And Rural Areas"
)] <- 2
child_2015$urban[child_2015$urban %in% c("3 The Town Center",
"4 ZhenXiang Area",
"5 Special Area",
"6 Township Central",
"7 Village")] <- 1
child_2015$urban[child_2015$urban %in% c("unkown")] <- NA
child_2015$urban <- child_2015$urban %>% factor(
levels = c(1:3),
labels = c(
"1 other",
"2 Combination Zone Between Urban And Rural Areas",
"3 Main City Zone"
)
)
child_2015$education <- child_2015$education %>% as.character()
child_2015$education_years <- NA
child_2015$education_years[child_2015$education == "1 No formal education illiterate"] <-
0
child_2015$education_years[child_2015$education == "2 Did not finish primary school but capable of reading or writing" |
child_2015$education == "3 Sishu/home school"] <-
3
child_2015$education_years[child_2015$education == "4 Elementary school"] <-
6
child_2015$education_years[child_2015$education == "5 Middle school"] <-
9
child_2015$education_years[child_2015$education == "6 High school"] <-
12
child_2015$education_years[child_2015$education == "7 Vocational school"] <-
11
child_2015$education_years[child_2015$education == "8 Two-/Three-Year College / Associate degree"] <-
14
child_2015$education_years[child_2015$education == "9 Four-Year College / Bachelors degree"] <-
16
child_2015$education_years[child_2015$education == "10 Post-graduate, Masters degree"] <-
19
child_2015$education_years[child_2015$education == "11 Post-graduate, doctoral degree/Ph.D."] <-
22
child_2015$education[child_2015$education == "1 No formal education illiterate" |
child_2015$education == "2 Did not finish primary school but capable of reading or writing" |
child_2015$education == "3 Sishu/home school" |
child_2015$education == "4 Elementary school" |
child_2015$education == "5 Middle school"] <- 1
child_2015$education[child_2015$education == "6 High school"] <- 2
child_2015$education[child_2015$education == "7 Vocational school" |
child_2015$education == "8 Two-/Three-Year College / Associate degree"] <-
3
child_2015$education[child_2015$education == "9 Four-Year College / Bachelors degree" |
child_2015$education == "10 Post-graduate, Masters degree" |
child_2015$education == "11 Post-graduate, doctoral degree/Ph.D."] <-
4
child_2015$education <- child_2015$education %>% factor(
levels = c(1:4),
labels = c(
"1 Middle school and below",
"2 Middle and high school",
"3 Vocational school/some college",
"4 Bachelor and above"
)
)
child_2015$income <-
child_2015$income %>% as.character() %>% str_extract("^[:digit:]+ ") %>% as.numeric() %>% factor(
levels = (1:12),
labels = c(
"0",
"1000",
"2500",
"7500",
"15000",
"25000",
"40000",
"75000",
"125000",
"175000",
"250000",
"500000"
)
)%>%as.character()%>%as.numeric()
child_raw_2013 <- read.dta13("CHARLS2013/Child.dta")
child_2013 <- child_raw_2013 %>% select(id = ID,
childid = childID,
jobcat = cb071)
child_2013$jobcat <- child_2013$jobcat %>% as.character()
child_2013$jobcat[child_2013$jobcat == "5 Agricultural, Forestry, Husbandry and Fishery Producer"] <-
1
child_2013$jobcat[child_2013$jobcat == "6 Production and Transportation worker"] <-
2
child_2013$jobcat[child_2013$jobcat == "4 Commerical and Service worker"] <-
3
child_2013$jobcat[child_2013$jobcat == "3 Clerk"] <- 4
child_2013$jobcat[child_2013$jobcat == "2 Professional and Technician"] <-
5
child_2013$jobcat[child_2013$jobcat == "1 Manager"] <- 6
child_2013$jobcat <- child_2013$jobcat %>% factor(
levels = c(1:6),
labels = c(
"1 Peasants",
"2 Industrial workers",
"3 Employees of services",
"4 Clerical personnel",
"5 Professionals and Technicians",
"6 State, social and enterprise managers"
)
)
child_2015 <- right_join(child_2013,
child_2015,
by = c("id", "childid"))
child_2015$homevalue[child_2015$home == "2 No"] <- 0
child_2015$homevalue[child_2015$homevalue < 0] <- NA
child_2015$homevalue[child_2015$homevalue > 1000] <- 1000
transfer_raw_2015 <- read.dta13("CHARLS2015/Family_Transfer.dta")
transfer_2015 <- transfer_raw_2015 %>% select(
hhid = householdID,
ce029_1_1_:ce029_1_16_,
#money support
ce069_w2_1_1_:ce069_w2_1_15_,
ce070_w2_1_1_:ce070_w2_1_9_
)#buy marriage house
transfer_2015$ce069_w2_1_16_ <- "2"
transfer_raw_2013 <- read.dta13("CHARLS2013/Family_Transfer.dta")
transfer_2013 <- transfer_raw_2013 %>% select(hhid = householdID,
ce031_1_1_:ce031_1_11_)#money support
child_2015$gift <- NA
child_2015$transfer <- NA
child_2015$marriagehome <- NA
child_2015$marriagehomevalue <- NA
for (i in 1:nrow(child_2015)) {
household <- child_2015$hhid[i]
if (household %in% transfer_2015$hhid) {
record <- transfer_2015 %>% filter(hhid == household)
#marriage home
child_2015$marriagehome[i] <- record[[paste("ce069_w2_1_",
child_2015$childid[i],
"_",
sep = "")]]
if (child_2015$childid[i] <= 9) {
child_2015$marriagehomevalue[i] <- record[[paste("ce070_w2_1_",
child_2015$childid[i],
"_",
sep = "")]]
}
#Gift transfer
child_2015$gift[i] <- record[[paste("ce029_1_",
child_2015$childid[i],
"_",
sep = "")]]
if (household %in% transfer_2013$hhid & child_2015$childid[i] <= 11) {
record_2013 <- transfer_2013 %>% filter(hhid == household)
if (is.null(record_2013[[paste("ce031_1_",
child_2015$childid[i],
sep = "")]]) == FALSE) {
gift_2013[is.na(gift_2013) == TRUE] <- 0
child_2015$gift[i] <- child_2015$gift[i] + gift_2013
}
}
}
}
child_2015$gift[child_2015$gift < 0] <- 0
child_2015$gift[is.na(child_2015$gift) == TRUE] <- 0
child_2015$marriagehome[is.na(child_2015$marriagehome) == TRUE] <-
"No marriage home"
child_2015$marriagehome[child_2015$marriagehome == 2] <-
"No marriage home"
child_2015$marriagehome[child_2015$marriagehome == 1] <-
"Parent buy marriage home"
for (i in 1:nrow(child_2015)) {
if (is.na(child_2015$marriagehomevalue[i]) == FALSE &
child_2015$marriagehomevalue[i] >= 1000) {
child_2015$marriagehomevalue[i] <-
child_2015$marriagehomevalue[i] / 1000
}
if (is.na(child_2015$marriagehomevalue[i]) == TRUE &
child_2015$marriagehome[i] == "Parent buy marriage home") {
child_2015$marriagehomevalue[i] <-
child_2015$marriagehomevalue %>% median(na.rm = TRUE)
}
}
child_2015$marriagehomevalue[is.na(child_2015$marriagehomevalue)] <- 0
child <- child_2015 %>% select(-distance,-address_parent)
#Add prefix of "child_" to all vars
names(child)[!names(child) %in% c("childid",
"hhid",
"cid")] <-
names(child)[!names(child) %in% c("childid",
"hhid",
"cid")] %>% str_c("child", sep = "_")
unique_hhids <- dta_hh$hhid %>% unique()
householder <- NULL
for (i in unique_hhids) {
dta <- dta_hh %>% filter(hhid == i)
dta <- dta[order(dta$role, decreasing = FALSE), ]
record <- dta[1, ]
householder <- householder %>% rbind(record)
}
merged_charls <- inner_join(child, householder, by = c("hhid"))
merged_charls$onlychild <- NA
for (i in 1:nrow(merged_charls)) {
dta <-
merged_charls %>% filter(merged_charls$hhid == merged_charls$hhid[i])
if (nrow(dta) == 1) {
merged_charls$onlychild[i] <- "only child"
}
if (nrow(dta) > 1 & merged_charls$childid[i] == 1) {
merged_charls$onlychild[i] <- "first child"
}
if (nrow(dta) > 1 & merged_charls$childid[i] > 1) {
merged_charls$onlychild[i] <- "later child"
}
}
save(merged_charls, file = "output/merged_charls.RData")
